<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/normalizr@3.6.1/dist/normalizr.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
</head>
<style>
  .failLogin {
    border-color: red !important;
  }

  .displayNone {
    display: none;
  }

  .displayOn {
    display: initial;
  }
</style>

<body>
<div class="shadow-lg p-3 mb-5 bg-white rounded"
    style="margin:10%">
<form id="updateUserForm">
  <div class="form-group">
    <label for="usernameInput">Username</label>
    <input type="text" class="form-control" id="usernameInput" name="preUsername" placeholder="{{user.username}}" disabled>
  </div>
  <div class="form-group">
    <label for="ipInput">Ingrese el nuevo Username</label>
    <input type="text" class="form-control" id="newUserInput" name="username" required>
  </div>
  <div class="form-group">
    <label for="passwordInput">Ingrese la nueva contraseña</label>
    <input type="password" class="form-control" id="passwordInput" name="password" required>
  </div>
  <div class="form-group">
    <label for="ipInput">Ingrese la nueva IP</label>
    <input type="text" class="form-control" id="ipInput" name="ip" required>
  </div>
  <button type="submit" class="btn btn-primary">Update User</button>
</form>
    <form action="/" method="get">
      <button class="btn btn-dark mt-5 mb-5">Volver</button>
    </form>
</div>
</body>

<script>
document.getElementById('updateUserForm').addEventListener('submit', event => {
  event.preventDefault(); // evitar la acción predeterminada del formulario
  
  // obtener los valores de los campos del formulario
  var newUsername = document.getElementById('newUserInput').value;
  var password = document.getElementById('passwordInput').value;
  var ip = document.getElementById('ipInput').value;
  
  // crear un objeto de datos con los valores de los campos
  var data = {
    username: "{{user.username}}",
    newUsername:newUsername,
    password: password,
    ip: ip
  };
  
  // hacer una solicitud PUT al endpoint
  fetch('/user/{{user.username}}', {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => {
    if (response.ok) {
     window.location.href = '/successupdate'
    } else {
      // si la respuesta no es exitosa, mostrar un mensaje de error
      alert('Hubo un error al actualizar el usuario');
    }
  })
  .catch(error => {
    // manejar el error
    alert('Hubo un error al actualizar el usuario');
  });
});
</script>
</html>